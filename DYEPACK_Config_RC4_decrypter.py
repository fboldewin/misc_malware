# Decrypts APT38 DYEPACK config file encrypted with RC4 using Malduck
# Reference: https://baesystemsai.blogspot.com/2016/04/two-bytes-to-951m.html
# Config file: (gpca.dat)  - 6207b92842b28a438330a2bf0ee8dcab7ef0a163
#
# Proof of Concept code by Frank Boldewin (@r3c0nst)

from malduck import rc4

# RC4 key extracted from original malware => nroff_b.exe - 5b7c970fee7ebe08d50665f278d47d0e34c04acc19a91838de6a3fc63a8e5630
key = b'\x4e\x38\x1f\xa7\x7f\x08\xcc\xaa\x0d\x56\xed\xef\xf9\xed\x08\xef'

def main():
	with open('gpca.dat', 'rb') as cryptedfile:
		data = cryptedfile.read()
		result = rc4(key,data)
		if result:
			with open('gpca.dat.dec', 'wb') as decryptedfile:
				decryptedfile.write(result)
				print(f'\nDecrypted buffer! Check => gpca.dat.dec')
		else:
			print(f'\nMalduck was not able to decrypt buffer.')

if __name__ == "__main__":
	main()
